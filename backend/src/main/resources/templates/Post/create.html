<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/userbase :: layout(~{::content}, ~{::script})}">

<body>
    <section th:fragment="content" x-data="{ images: [], files: [] }">

        <div class="max-w-xl mx-auto bg-white rounded-xl border p-6 shadow-sm">

            <h2 class="text-xl font-semibold mb-4">Tạo bài viết</h2>

            <!-- Form -->
            <form th:action="@{/post/create}" method="post" enctype="multipart/form-data">

                <!-- Nội dung -->
                <textarea name="content" rows="3" class="w-full border rounded-lg p-3 mb-4 resize-none"
                    placeholder="Bạn đang nghĩ gì?"></textarea>

                <!-- Upload ảnh -->
                <div class="mb-3">
                    <label class="block mb-1 font-medium">Chọn ảnh</label>

                    <!-- input file real -->
                    <input type="file" x-ref="fileInput" name="images" multiple accept="image/*" class="hidden" @change="
                            images = [];
                            files = [...$refs.fileInput.files];

                            files.forEach(file => {
                                const reader = new FileReader();
                                reader.onload = e => images.push(e.target.result);
                                reader.readAsDataURL(file);
                            });
                       ">

                    <button type="button" @click="$refs.fileInput.click()"
                        class="px-4 py-2 bg-neutral-900 text-white rounded-lg">
                        Chọn ảnh
                    </button>
                </div>

                <!-- Preview ảnh -->
                <div class="grid grid-cols-3 gap-3 mb-4" x-show="images.length > 0">
                    <template x-for="(img, i) in images" :key="i">
                        <div class="relative group">

                            <img :src="img" class="w-full h-28 object-cover rounded-lg border">

                            <!-- nút xóa -->
                            <button type="button" @click="images.splice(i,1); files.splice(i,1)" class="absolute top-1 right-1 w-6 h-6 bg-black/60 text-white rounded-full
                                       hidden group-hover:flex items-center justify-center">
                                ✕
                            </button>
                        </div>
                    </template>
                </div>

                <!-- Visibility -->
                <select name="visibility" class="w-full border rounded-lg p-2 mb-4">
                    <option value="PUBLIC">Công khai</option>
                    <option value="FRIENDS">Bạn bè</option>
                    <option value="PRIVATE">Chỉ mình tôi</option>
                </select>

                <button class="w-full bg-neutral-900 text-white py-2 rounded-lg hover:bg-black">
                    Đăng bài
                </button>

            </form>

        </div>

    </section>

    <!-- ===================== SCRIPTS ===================== -->
    <section th:fragment="script">
        <script src="/js/reactions.js"></script>
    </section>
</body>

</html>
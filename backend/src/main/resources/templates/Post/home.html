<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/userbase :: layout(~{::content})}">

<body>
    <section th:fragment="content">

        <div class="max-w-2xl mx-auto space-y-6">

            <div th:each="post : ${posts}" class="bg-white border border-neutral-200 rounded-2xl p-5 shadow-sm">

                <!-- ================= HEADER ================= -->
                <header class="flex items-center gap-3 mb-4">

                    <!-- Avatar -->
                    <div>
                        <img th:if="${post.author.avatarUrl != null}" th:src="${post.author.avatarUrl}"
                            class="w-10 h-10 rounded-full object-cover">

                        <div th:if="${post.author.avatarUrl == null}" class="w-10 h-10 rounded-full bg-neutral-300">
                        </div>
                    </div>

                    <!-- Tên + thời gian -->
                    <div>
                        <p class="font-semibold text-sm" th:text="${post.author.username}"></p>
                        <p class="text-xs text-neutral-500"
                            th:text="${#temporals.format(post.createdAt,'dd/MM/yyyy HH:mm')}"></p>
                    </div>

                </header>

                <!-- ================= CONTENT ================= -->
                <p class="text-sm mb-3" th:text="${post.content}"></p>

                <!-- Hình Ảnh -->
                <div th:if="${post.images != null and !#lists.isEmpty(post.images)}" class="grid gap-2" th:classappend="${#lists.size(post.images) == 1 ? 'grid-cols-1' :
                                  (#lists.size(post.images) == 2 ? 'grid-cols-2' :
                                  (#lists.size(post.images) == 3 ? 'grid-cols-2 grid-rows-2' :
                                  'grid-cols-3'))}">
                    <div th:each="img : ${post.images}">
                        <img th:src="@{'/uploads/' + ${img.imageUrl}}" class="rounded-xl w-full object-cover max-h-80">
                    </div>
                </div>

                <!-- ================= FOOTER ================= -->
                <footer class="mt-3 pt-3 border-t text-sm text-neutral-600">
                
                    <div class="flex items-center justify-between">
                
                        <!-- LIKE + REACTIONS -->
                        <div class="relative" x-data="{ open: false }">
                
                            <!-- Nút Like -->
                            <button @mouseenter="open = true" @mouseleave="open = false"
                                class="px-3 py-1 rounded-lg hover:bg-neutral-100 flex items-center gap-1">
                
                                <img src="/reactions/like.png" class="w-5 h-5 object-contain">
                                <span>Thích</span>
                            </button>
                
                            <!-- Popup Reaction -->
                            <div x-show="open" @mouseenter="open = true" @mouseleave="open = false" x-transition class="absolute bottom-full left-0 mb-2 bg-white border rounded-full px-3 py-2 shadow-lg 
                                        flex items-center gap-3 z-50 h-14">
                            
                                <template x-for="(r, index) in [
                                    {type:'LIKE',  src:'/reactions/like.png'},
                                    {type:'LOVE',  src:'/reactions/love.png'},
                                    {type:'HAHA',  src:'/reactions/haha.png'},
                                    {type:'WOW',   src:'/reactions/wow.png'},
                                    {type:'SAD',   src:'/reactions/sad.png'},
                                    {type:'ANGRY', src:'/reactions/angry.png'}
                                ]" :key="index">
                            
                                    <button @click="sendReaction(r.type, [[${post.id}]])"
                                        class="hover:scale-125 transition duration-150 flex items-center justify-center">
                            
                                        <!-- FIX QUAN TRỌNG: ép width + height cố định -->
                                        <img :src="r.src" class="w-10 h-10 shrink-0 object-contain rounded-full bg-white">
                                    </button>
                            
                                </template>
                            </div>

                
                        </div>
                
                        <!-- Xem chi tiết -->
                        <a th:href="@{/post/{id}(id=${post.id})}" class="text-blue-600 hover:underline">
                            Xem chi tiết →
                        </a>
                    </div>
                
                    <!-- Like & Comment Count -->
                    <div class="mt-1 text-xs text-neutral-500">
                        <span th:text="${post.likeCount} + ' lượt thích'"></span> ·
                        <span th:text="${post.commentCount} + ' bình luận'"></span>
                    </div>
                
                </footer>

            </div>

        </div>

    </section>

    <!-- Reaction script -->
    <script>
        function sendReaction(type, postId) {
            console.log("Reaction:", type, "Post:", postId);
            // TODO: gọi API ở đây
        }
    </script>

</body>

</html>